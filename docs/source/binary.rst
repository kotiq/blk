==================
–î–≤–æ–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã BLK
==================

---------------
–û–±—â–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
---------------

.. list-table:: –¢–∏–ø —Ñ–∞–π–ª–∞ –ø–æ –ø–µ—Ä–≤–æ–º—É –±–∞–π—Ç—É
    :header-rows: 1
    :align: left

    * - –ü–µ—Ä–≤—ã–π –æ–∫—Ç–µ—Ç
      - –¢–∏–ø
    * - 0x00
      - BBF
    * - 0x01
      - FAT
    * - 0x02
      - FAT_ZST
    * - 0x03
      - SLIM
    * - 0x04
      - SLIM_ZST
    * - 0x05
      - SLIM_ZST_DICT

.. list-table:: –¢–∞–±–ª–∏—Ü–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    :header-rows: 1
    :align: left

    * - –ü—Å–µ–≤–¥–æ–Ω–∏–º
      - –ö–æ–¥ —Ç–∏–ø–∞
      - –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
      - –î–ª–∏–Ω–∞, –æ–∫—Ç–µ—Ç–æ–≤
      - –ö–æ—Ä–æ—Ç–∫–∏–π
    * - Str
      - 0x01
      - CString
      - Var
      - \
    * - Int
      - 0x02
      - Int32sl
      - 4
      - üó∏
    * - Float
      - 0x03
      - Float32sl
      - 4
      - üó∏
    * - Float2
      - 0x04
      - Float32sl[2]
      - 8
      - \
    * - Float3
      - 0x05
      - Float32sl[3]
      - 12
      - \
    * - Float4
      - 0x06
      - Float32sl[4]
      - 16
      - \
    * - Int2
      - 0x07
      - Int32sl[2]
      - 8
      - \
    * - Int3
      - 0x08
      - Int32sl[3]
      - 12
      - \
    * - Bool
      - 0x09
      - Int32ul
      - 4
      - üó∏
    * - Color
      - 0x0a
      - Int8ul[4]
      - 4
      - üó∏
    * - Float12
      - 0x0b
      - Float32sl[12]
      - 48
      - \
    * - Long
      - 0x0c
      - Int64sl
      - 8
      - \

–¶–µ–ª–æ–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª–∏–Ω—ã
======================

–§–æ—Ä–º–∞—Ç ULEB128 ``vlq_base128_le``

–¢–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å (Tagged index)
==================================

–¢–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å –∫–æ–¥–∏—Ä—É–µ—Ç –≤–∏–¥ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å—Ç—Ä–æ–∫ –∏ –∞–¥—Ä–µ—Å —Å—Ç—Ä–æ–∫–∏ –≤ —ç—Ç–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ. –ü–æ—Ä—è–¥–æ–∫ –±–∞–π—Ç–æ–≤ LE.

.. drawio-image:: diagrams/tagged_index.drawio

Tag
    Bit(1), —Ç–µ–≥. –°—Ç—Ä–æ–∫–∞ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –∏–∑ –∫–∞—Ä—Ç—ã –∏–º–µ–Ω, –µ—Å–ª–∏ —Ç–µ–≥ 1, –∏–Ω–∞—á–µ –∏–∑ –±–ª–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª–∏–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

Index
    Bit(31), –∏–Ω–¥–µ–∫—Å. –ò–Ω–¥–µ–∫—Å –≤ –∫–∞—Ä—Ç–µ –∏–º–µ–Ω –∏–ª–∏ —Å–º–µ—â–µ–Ω–∏–µ –≤ –±–ª–æ–∫–µ –¥–ª–∏–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ ParameterInfo
=======================

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∫–æ–¥–∏—Ä—É–µ—Ç –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä.

.. drawio-image:: diagrams/parameter_info.drawio

Name ID
    Int24ul, –∏–Ω–¥–µ–∫—Å –∏–º–µ–Ω–∏ –≤ –∫–∞—Ä—Ç–µ –∏–º–µ–Ω.

Type ID
    Int8ul, –∫–æ–¥ —Ç–∏–ø–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞.

Parameter data
    | Int32ul, –∏–Ω–¥–µ–∫—Å –¥–ª–∏–Ω–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –¥–ª—è –∫–æ–¥–æ–≤ —Ç–∏–ø–∞ ``Str``, ``Float12``, ``Float4``, ``Float3``, ``Float2``, ``Int3``, ``Int2``, ``Long``.
    | –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –∫–æ–¥–∞ —Ç–∏–ø–∞ ``Str``.
    | –ó–Ω–∞—á–µ–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –∫–æ–¥–æ–≤ —Ç–∏–ø–∞ ``Color``, ``Int``, ``Float``, ``Bool``.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ BlockInfo
===================

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–ª–æ–∫–∞ –∫–æ–¥–∏—Ä—É–µ—Ç –±–ª–æ–∫, –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –∏–ª–∏ –±–µ–∑—ã–º—è–Ω–Ω—ã–π.

.. drawio-image:: diagrams/block_info.drawio

Name ID
    VarInt, –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–º–µ–Ω–∏ –±–ª–æ–∫–∞.
    | –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ t –±–æ–ª—å—à–µ –Ω—É–ª—è, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—é (t - 1) –∏–∑ –∫–∞—Ä—Ç—ã –∏–º–µ–Ω.
    | –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ t = 0 –¥–ª—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –±–ª–æ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –∏–º–µ–µ—Ç –∏–º–µ–Ω–∏.

Parameters count
    VarInt, —á–∏—Å–ª–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –≤—ã–±–∏—Ä–∞–µ–º—ã—Ö –∏–∑ –ø–æ—Ç–æ–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

Blocks count
    VarInt, —á–∏—Å–ª–æ –ø–æ–¥–±–ª–æ–∫–æ–≤.

First block index
    (VarInt)?, –∏–Ω–¥–µ–∫—Å –ø–µ—Ä–≤–æ–≥–æ –ø–æ–¥–±–ª–æ–∫–∞, –µ—Å–ª–∏ –µ—Å—Ç—å.

-------------
–§–∞–π–ª —Ç–∏–ø–∞ FAT
-------------

–ê–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Ñ–∞–π–ª.

–ü—Ä–∏–º–µ—Ä—ã:

* ``WarThunder/game.vromfs.bin/danetlibs/route_prober/templates/route_prober.blk``
* ``tests/samples/section_fat.blk``

.. drawio-image:: diagrams/fat.drawio

File type
    Int8ul, —Ç–∏–ø —Ñ–∞–π–ª–∞ FileType.FAT

Names count
    VarInt, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–º–µ–Ω.

Names data size
    VarInt, —Ä–∞–∑–º–µ—Ä –º–∞—Å—Å–∏–≤–∞ –∏–º–µ–Ω –≤ –æ–∫—Ç–µ—Ç–∞—Ö

Names[Names count]
    | –ú–∞—Å—Å–∏–≤ CString –∏–º–µ–Ω.
    | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏–º–µ–Ω –ø–æ –ø–æ—Ä—è–¥–∫—É —á—Ç–µ–Ω–∏—è –º–∞—Å—Å–∏–≤–∞.

Blocks count
    VarInt, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –≤ —Ñ–∞–π–ª–µ, –≤–∫–ª—é—á–∞—è –∫–æ—Ä–Ω–µ–≤–æ–π –±–ª–æ–∫.

Parameters count
    VarInt, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ —Ñ–∞–π–ª–µ

Parameters data size
    VarInt, —Ä–∞–∑–º–µ—Ä –º–∞—Å—Å–∏–≤–∞ –¥–ª–∏–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –æ–∫—Ç–µ—Ç–∞—Ö.

Parameters data
    | –†–µ–≥–∏–æ–Ω –¥–ª–∏–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
    | –°–º–µ—â–µ–Ω–∏–µ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ ParamInfo –æ—Ç –Ω–∞—á–∞–ª–∞ —Ä–µ–≥–∏–æ–Ω–∞.

ParameterInfo[Parameters count]
    | –ú–∞—Å—Å–∏–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä ParamInfo.
    | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ –ø–æ—Ä—è–¥–∫—É —á—Ç–µ–Ω–∏—è –º–∞—Å—Å–∏–≤–∞.

BlockInfo[Block count]
    | –ú–∞—Å—Å–∏–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä BlockInfo, –≤–∫–ª—é—á–∞—è –∫–æ—Ä–Ω–µ–≤–æ–π –±–ª–æ–∫.
    | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –±–ª–æ–∫–æ–≤ –ø–æ –ø–æ—Ä—è–¥–∫—É —á—Ç–µ–Ω–∏—è –º–∞—Å—Å–∏–≤–∞.
    | –ë–ª–æ–∫–∏ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –ø—Ä–∏ –æ–±—Ö–æ–¥–µ –¥–µ—Ä–µ–≤–∞ –±–ª–æ–∫–æ–≤ –≤ —à–∏—Ä–∏–Ω—É.

–ü—Ä–∏–º–µ—Ä —Ä–∞–∑–±–æ—Ä–∞
==============

–§–∞–π–ª tests/samples/section_fat.blk
----------------------------------

.. drawio-image:: diagrams/section_fat_dump.drawio

–ö–∞—Ä—Ç–∞ –∏–º–µ–Ω
----------

.. list-table:: –ö–∞—Ä—Ç–∞ –∏–º–µ–Ω
    :header-rows: 1
    :align: left

    * - –ò–Ω–¥–µ–∫—Å
      - –ò–º—è
    * - 0x00
      - vec4f
    * - 0x01
      - int
    * - 0x02
      - long
    * - 0x03
      - alpha
    * - 0x04
      - str
    * - 0x05
      - bool
    * - 0x06
      - color
    * - 0x07
      - gamma
    * - 0x08
      - vec2i
    * - 0x09
      - vec2f
    * - 0x0a
      - transform
    * - 0x0b
      - beta
    * - 0x0c
      - float
    * - 0x0d
      - vec3f

–ú–∞—Å—Å–∏–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä ParamInfo –∏ —Ä–µ–≥–∏–æ–Ω Parameters data
--------------------------------------------------

.. drawio-image:: diagrams/section_fat_param_info_array_and_params_data_dump.drawio

.. list-table:: –ö–∞—Ä—Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    :header-rows: 1
    :align: left
    :widths: 10 20 70

    * - –ò–Ω–¥–µ–∫—Å
      - –ò–º—è
      - –ó–Ω–∞—á–µ–Ω–∏–µ
    * - 0
      - \'vec4f\'
      - Float4(1.25, 2.5, 5.0, 10.0)
    * - 1
      - \'int\'
      - Int(42)
    * - 2
      - \'long\'
      - Long(64)
    * - 3
      - \'str\'
      - Str(\'hello\')
    * - 4
      - \'bool\'
      - true
    * - 5
      - \'color\'
      - Color(1, 2, 3, 4)
    * - 6
      - \'float\'
      - Float(1.25)
    * - 7
      - \'vec2i\'
      - Int2(1, 2)
    * - 8
      - \'vec3f\'
      - Float3(1.25, 2.5, 5.0)
    * - 9
      - \'vec2i\'
      - Int2(3, 4)
    * - 10
      - \'vec2f\'
      - Float2(1.25, 2.5)
    * - 11
      - \'transform\'
      - Float12(1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 1.25, 2.5, 5.0)

–ú–∞—Å—Å–∏–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä BlockInfo
-------------------------

.. drawio-image:: diagrams/section_fat_block_info_array_dump.drawio

.. list-table:: –ö–∞—Ä—Ç–∞ –±–ª–æ–∫–æ–≤
    :header-rows: 1
    :align: left
    :widths: 10 20 35 35

    * - –ò–Ω–¥–µ–∫—Å
      - –ò–º—è
      - –ò–Ω–¥–µ–∫—Å—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
      - –ò–Ω–¥–µ–∫—Å—ã –ø–æ–¥–±–ª–æ–∫–æ–≤
    * - 0
      - None
      - (0, 1, 2)
      - (1, 2)
    * - 1
      - \'alpha\'
      - (3, 4, 5)
      - (3, )
    * - 2
      - \'beta\'
      - (6, 7, 8)
      - ()
    * - 3
      - \'gamma\'
      - (9, 10, 11)
      - ()

–î–µ—Ä–µ–≤–æ –±–ª–æ–∫–æ–≤
^^^^^^^^^^^^^

.. drawio-image:: diagrams/section_fat_blocks_tree.drawio


–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –±–ª–æ–∫–∞
^^^^^^^^^^^^^^^^^^^^^^^^^^

.. code-block:: javascript

    "vec4f":p4 = 1.25, 2.5, 5, 10
    "int":i = 42
    "long":i64 = 0x40
    "alpha" {
      "str":t = "hello"
      "bool":b = true
      "color":c = 0x1, 0x2, 0x3, 0x4
      "gamma" {
        "vec2i":ip2 = 3, 4
        "vec2f":p2 = 1.25, 2.5
        "transform":m = [[1, 0, 0] [0, 1, 0] [0, 0, 1] [1.25, 2.5, 5]]
      }
    }
    "beta" {
      "float":r = 1.25
      "vec2i":ip2 = 1, 2
      "vec3f":p3 = 1.25, 2.5, 5
    }



